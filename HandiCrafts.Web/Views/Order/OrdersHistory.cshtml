@model IEnumerable<HandiCrafts.Web.CustomerOrderDto>

@{
    ViewData["Title"] = "لیست خریدهای قبلی من";
    Layout = "~/Views/Shared/_UserPanelLayout.cshtml";
}

@section Styles{
    <link href="~/css/userpanel/upanelcss.css" rel="stylesheet" />
    <style>
        .badge-pill {
            padding: .4em .6em;
        }
        .profile-tab .nav-link span.badge.bg-firouzi {
            background-color: #8e8e8e;
        }
        .profile-tab .nav-link.active span.badge.bg-firouzi {
            background-color: #0aa8b9;
        }
        @@media only screen and (max-width: 600px) {
            .tab-a-span-with-img {
                display: inline-block;
                float: right;
                margin-left: 10px;
                max-width: 45px;
                max-height: 45px;
                width: 45px;
                height: 45px;
            }
            .tab-profile-title{
                line-height:38px;
            }
        }

        /* Small devices (portrait tablets and large phones, 600px and up) */
        @@media only screen and (min-width: 600px) {
            .tab-a-span-with-img {
                display: inline-block;
                float: right;
                margin-left: 10px;
                max-width: 45px;
                max-height: 45px;
                width: 45px;
                height: 45px;
            }
            .tab-profile-title {
                line-height: 38px;
            }
        }
        /* Medium devices (landscape tablets, 768px and up) */
        @@media only screen and (min-width: 768px) {
            .tab-a-span-with-img {
                display: inline-block;
                float: right;
                margin-left: 10px;
                max-width: 45px;
                max-height: 45px;
                width: 45px;
                height: 45px;
            }

            .tab-profile-title {
                line-height: 38px;
            }
        }

        /* Large devices (laptops/desktops, 992px and up) */
        @@media only screen and (min-width: 992px) {
            .tab-a-span-with-img {
                display: inline-block;
                float: right;
                margin-left: 10px;
                max-width: 45px;
                max-height: 45px;
                width: 45px;
                height: 45px;
            }

            .tab-profile-title {
                line-height: 38px;
            }
        }

        /* Extra large devices (large laptops and desktops, 1200px and up) */
        @@media only screen and (min-width: 1200px) {
            .tab-a-span-with-img {
                display: block;
                float: none;
                margin-left: auto;
                max-width: 75px;
                max-height: 75px;
                width: 75px;
                height: 75px;
            }

            .tab-profile-title {
                line-height: inherit;
            }
        }
    </style>
}

@{
    if (Model == null)
    {
        <script>
            window.location = "/Account/login"
        </script>
    }
    else
    {
        int sabadHa = 0;
        int successHa = 0;
        int processHa = 0;
        int sendHa = 0;
        int tahvilHa = 0;
        int marjueHa = 0;
        foreach (var item in Model)
        {
            switch (item.FinalStatusId)
            {
                case 12: sabadHa++; break;
                case 27: successHa++; break;
                case 18: processHa++; break;
                case 19: sendHa++; break;
                case 20: sendHa++; break;
                case 21: tahvilHa++; break;
                default:
                    break;
            }
        }
        <div class="container mt-4">

            <ul class="nav nav-tabs responsive nav-pills nav-fill profile-tab ml-3 mr-3" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#tab1" role="tab">
                        <div>
                            <span class="tab-a-span-with-img o-cart-img">
                            </span><span class="tab-profile-title">سبدهای خرید <span class="badge badge-pill bg-firouzi ml-1 mr-1">@sabadHa</span></span>
                        </div>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#tab2" role="tab">
                        <div>
                            <span class="tab-a-span-with-img o-successfull-img">
                            </span>
                            <span class="tab-profile-title">سفارش موفق <span class="badge badge-pill bg-firouzi ml-1 mr-1">@successHa</span></span>
                        </div>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#tab3" role="tab">
                        <div>
                            <span class="tab-a-span-with-img o-processing-img">
                            </span>
                            <span class="tab-profile-title">درحال پردازش <span class="badge badge-pill bg-firouzi ml-1 mr-1">@processHa</span></span>
                        </div>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#tab4" role="tab">
                        <div>
                            <span class="tab-a-span-with-img o-send-img">
                            </span>
                            <span class="tab-profile-title">ارسال <span class="badge badge-pill bg-firouzi ml-1 mr-1">@sendHa</span></span>
                        </div>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#tab5" role="tab">
                        <div>
                            <span class="tab-a-span-with-img o-delivery-img">
                            </span>
                            <span class="tab-profile-title">تحویل داده شده <span class="badge badge-pill bg-firouzi ml-1 mr-1">@tahvilHa</span></span>
                        </div>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#tab6" role="tab">
                        <div>
                            <span class="tab-a-span-with-img o-returned-img">
                            </span>
                            <span class="tab-profile-title">مرجوعی <span class="badge badge-pill bg-firouzi ml-1 mr-1">@marjueHa</span></span>
                        </div>
                    </a>
                </li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content responsive tab-content-profile">
                <div class="tab-pane active" id="tab1" role="tabpanel">
                    <div class="container-fluid">
                        <div class="row mt-3">
                            <div class="col">
                                <ul class="list-unstyled">
                                    @{
                                        foreach (var item in Model)
                                        {
                                            if (item.FinalStatusId == 12)
                                            {
                                                var dt = !string.IsNullOrEmpty(item.OrderDate) ? item.OrderDate : PersianDateTime.Now.ToString();
                                                PersianDateTime persiandt = PersianDateTime.Parse(dt); //new PersianDateTime(DateTime.Parse(dt));

                                                <li class="li-order-row">
                                                    <h5 class="color-black">@persiandt.Day ام @persiandt.MonthName ماه @persiandt.Year سبد خرید ایجاد شده است</h5>
                                                    <h5 class="mt-4 mb-5">مبلغ کل: @string.Format("{0:n0}", item.FinalPrice) تومان</h5>
                                                    <ul class="list-unstyled d-inline-block mb-3 order-list-a-img">
                                                        @{
                                                            foreach (var prods in item.ProductList)
                                                            {
                                                                <li class="text-center mr-3 ml-3">
                                                                    <a href="/product/Index?id=@prods.Id">
                                                                        <img src="@prods.CoverImage" />
                                                                        <span class="prd-title">@prods.ProductName</span>
                                                                    </a>
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                    <div>
                                                        <a href="/Order/OrderById?orderId=@item.Id" class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده جزییات سفارش</a>
                                                        <a class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده فاکتور</a>
                                                    </div>
                                                </li>
                                            }
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab2" role="tabpanel">
                    <div class="container-fluid">
                        <div class="row mt-3">
                            <div class="col">
                                <ul class="list-unstyled">
                                    @{
                                        foreach (var item in Model)
                                        {
                                            if (item.FinalStatusId == 27)
                                            {
                                                var dt = !string.IsNullOrEmpty(item.OrderDate) ? item.OrderDate : PersianDateTime.Now.ToString();
                                                PersianDateTime persiandt = PersianDateTime.Parse(dt); //new PersianDateTime(DateTime.Parse(dt));

                                                <li class="li-order-row">
                                                    <h5 class="color-black">@persiandt.Day ام @persiandt.MonthName ماه @persiandt.Year سفارش ثبت شد</h5>
                                                    <h5 class="mt-4 mb-5">مبلغ کل: @string.Format("{0:n0}", item.FinalPrice) تومان</h5>
                                                    <ul class="list-unstyled d-inline-block mb-3 order-list-a-img">
                                                        @{
                                                            foreach (var prods in item.ProductList)
                                                            {
                                                                <li class="text-center mr-3 ml-3">
                                                                    <a href="/product/Index?id=@prods.Id">
                                                                        <img src="@prods.CoverImage" />
                                                                        <span class="prd-title">@prods.ProductName</span>
                                                                    </a>
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                    <div>
                                                        <a href="/Order/OrderById?orderId=@item.Id" class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده جزییات سفارش</a>
                                                        <a class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده فاکتور</a>
                                                    </div>
                                                </li>
                                            }
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab3" role="tabpanel">
                    <div class="container-fluid">
                        <div class="row mt-3">
                            <div class="col">
                                <ul class="list-unstyled">
                                    @{
                                        foreach (var item in Model)
                                        {
                                            if (item.FinalStatusId == 18)
                                            {
                                                var dt = !string.IsNullOrEmpty(item.OrderDate) ? item.OrderDate : PersianDateTime.Now.ToString();
                                                PersianDateTime persiandt = PersianDateTime.Parse(dt); //new PersianDateTime(DateTime.Parse(dt));

                                                <li class="li-order-row">
                                                    <h5 class="color-black">سفارش درحال آماده سازی می باشد</h5>
                                                    <h5 class="mt-4 mb-5">مبلغ کل: @string.Format("{0:n0}", item.FinalPrice) تومان</h5>
                                                    <ul class="list-unstyled d-inline-block mb-3 order-list-a-img">
                                                        @{
                                                            foreach (var prods in item.ProductList)
                                                            {
                                                                <li class="text-center mr-3 ml-3">
                                                                    <a href="/product/Index?id=@prods.Id">
                                                                        <img src="@prods.CoverImage" />
                                                                        <span class="prd-title">@prods.ProductName</span>
                                                                    </a>
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                    <div>
                                                        <a href="/Order/OrderById?orderId=@item.Id" class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده جزییات سفارش</a>
                                                        <a class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده فاکتور</a>
                                                    </div>
                                                </li>
                                            }
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab4" role="tabpanel">
                    <div class="container-fluid">
                        <div class="row mt-3">
                            <div class="col">
                                <ul class="list-unstyled">
                                    @{
                                        foreach (var item in Model)
                                        {
                                            if (item.FinalStatusId == 19 || item.FinalStatusId == 20)
                                            {
                                                var dt = !string.IsNullOrEmpty(item.OrderDate) ? item.OrderDate : PersianDateTime.Now.ToString();
                                                PersianDateTime persiandt = PersianDateTime.Parse(dt); //new PersianDateTime(DateTime.Parse(dt));

                                                <li class="li-order-row">
                                                    <h5 class="color-black">@persiandt.Day ام @persiandt.MonthName ماه @persiandt.Year تحویل پست داده شد</h5>
                                                    <h5 class="mt-4 mb-5">مبلغ کل: @string.Format("{0:n0}", item.FinalPrice) تومان</h5>
                                                    <ul class="list-unstyled d-inline-block mb-3 order-list-a-img">
                                                        @{
                                                            foreach (var prods in item.ProductList)
                                                            {
                                                                <li class="text-center mr-3 ml-3">
                                                                    <a href="/product/Index?id=@prods.Id">
                                                                        <img src="@prods.CoverImage" />
                                                                        <span class="prd-title">@prods.ProductName</span>
                                                                    </a>
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                    <div>
                                                        <a href="/Order/OrderById?orderId=@item.Id" class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده جزییات سفارش</a>
                                                        <a class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده فاکتور</a>
                                                    </div>
                                                </li>
                                            }
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab5" role="tabpanel">
                    <div class="container-fluid">
                        <div class="row mt-3">
                            <div class="col">
                                <ul class="list-unstyled">
                                    @{
                                        foreach (var item in Model)
                                        {
                                            if (item.FinalStatusId == 21)
                                            {
                                                var dt = !string.IsNullOrEmpty(item.OrderDate) ? item.OrderDate : PersianDateTime.Now.ToString();
                                                PersianDateTime persiandt = PersianDateTime.Parse(dt); //new PersianDateTime(DateTime.Parse(dt));

                                                <li class="li-order-row">
                                                    <h5 class="color-black">@persiandt.Day ام @persiandt.MonthName ماه @persiandt.Year تحویل داده شد</h5>
                                                    <h5 class="mt-4 mb-5">مبلغ کل: @string.Format("{0:n0}", item.FinalPrice) تومان</h5>
                                                    <ul class="list-unstyled d-inline-block mb-3 order-list-a-img">
                                                        @{
                                                            foreach (var prods in item.ProductList)
                                                            {
                                                                <li class="text-center mr-3 ml-3">
                                                                    <a href="/product/Index?id=@prods.Id">
                                                                        <img src="@prods.CoverImage" />
                                                                        <span class="prd-title">@prods.ProductName</span>
                                                                    </a>
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                    <div>
                                                        <a href="/Order/OrderById?orderId=@item.Id" class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده جزییات سفارش</a>
                                                        <a class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده فاکتور</a>
                                                    </div>
                                                </li>
                                            }
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tab6" role="tabpanel">
                    <div class="container-fluid">
                        <div class="row mt-3">
                            <div class="col">
                                <ul class="list-unstyled">
                                    @{
                                        foreach (var item in Model)
                                        {
                                            if (item.FinalStatusId == 22)
                                            {
                                                var dt = !string.IsNullOrEmpty(item.OrderDate) ? item.OrderDate : PersianDateTime.Now.ToString();
                                                PersianDateTime persiandt = PersianDateTime.Parse(dt); //new PersianDateTime(DateTime.Parse(dt));

                                                <li class="li-order-row">
                                                    <h5 class="color-black">@persiandt.Day ام @persiandt.MonthName ماه @persiandt.Year برگشت داده شد</h5>
                                                    <h5 class="mt-4 mb-5">مبلغ کل: @string.Format("{0:n0}", item.FinalPrice) تومان</h5>
                                                    <ul class="list-unstyled d-inline-block mb-3 order-list-a-img">
                                                        @{
                                                            foreach (var prods in item.ProductList)
                                                            {
                                                                <li class="text-center mr-3 ml-3">
                                                                    <a href="/product/Index?id=@prods.Id">
                                                                        <img src="@prods.CoverImage" />
                                                                        <span class="prd-title">@prods.ProductName</span>
                                                                    </a>
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                    <div>
                                                        <a href="/Order/OrderById?orderId=@item.Id" class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده جزییات سفارش</a>
                                                        <a class="cyan line-height-28px d-block"><i class="fa fa-chevron-down"></i> مشاهده فاکتور</a>
                                                    </div>
                                                </li>
                                            }
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
}

@section Scripts{
    <script>
        // heavily modified BS4 version of https://github.com/openam/bootstrap-responsive-tabs
        var fakewaffle = (function ($, fakewaffle) {
            'use strict';

            fakewaffle.responsiveTabs = function (collapseDisplayed) {

                fakewaffle.currentPosition = 'tabs';

                var tabGroups = $('.nav-tabs.responsive');
                var hidden = '';
                var visible = '';
                var activeTab = '';

                // 		if ( collapseDisplayed === undefined ) {
                // 			collapseDisplayed = [ 'xs', 'sm' ];
                // 		}

                // 		$.each( collapseDisplayed, function () {
                // 			hidden  += ' banana-' + this;
                // 			visible += ' visible-' + this;
                // 		} );

                hidden = ' d-none d-sm-flex';
                visible = ' d-sm-none';

                $.each(tabGroups, function (index) {
                    var collapseDiv;
                    var $tabGroup = $(this);
                    var tabs = $tabGroup.find('li a');

                    if ($tabGroup.attr('id') === undefined) {
                        $tabGroup.attr('id', 'tabs-' + index);
                    }

                    collapseDiv = $('<div></div>', {
                        'class': 'card-soup responsive' + visible,
                        'id': 'collapse-' + $tabGroup.attr('id')
                    });

                    $.each(tabs, function () {
                        var $this = $(this);
                        var oldLinkClass = $this.attr('class') === undefined ? '' : $this.attr('class');
                        var newLinkClass = 'accordion-toggle';
                        var oldParentClass = $this.parent().attr('class') === undefined ? '' : $this.parent().attr('class');
                        var newParentClass = 'card';
                        var newHash = $this.get(0).hash.replace('#', 'collapse-');

                        if (oldLinkClass.length > 0) {
                            newLinkClass += ' ' + oldLinkClass;
                        }

                        if (oldParentClass.length > 0) {
                            oldParentClass = oldParentClass.replace(/\bactive\b/g, '');
                            newParentClass += ' ' + oldParentClass;
                            newParentClass = newParentClass.replace(/\s{2,}/g, ' ');
                            newParentClass = newParentClass.replace(/^\s+|\s+$/g, '');
                        }

                        if ($this.parent().hasClass('active')) {
                            activeTab = '#' + newHash;
                        }

                        collapseDiv.append(
                            $('<div>').attr('class', newParentClass).html(
                                $('<div>').attr('class', 'card-header').html(
                                    $('<h4>').attr('class', 'card-title').html(
                                        $('<a>', {
                                            'class': newLinkClass,
                                            'data-toggle': 'collapse',
                                            'data-parent': '#collapse-' + $tabGroup.attr('id'),
                                            'href': '#' + newHash,
                                            'html': $this.html()
                                        })
                                    )
                                )
                            ).append(
                                $('<div>', {
                                    'id': newHash,
                                    'class': 'collapse'
                                })
                            )
                        );
                    });

                    $tabGroup.next().after(collapseDiv);
                    $tabGroup.addClass(hidden);
                    $('.tab-content.responsive').addClass(hidden);

                    if (activeTab) {
                        $(activeTab).collapse('show');
                    }
                });

                fakewaffle.checkResize();
                fakewaffle.bindTabToCollapse();
            };

            fakewaffle.checkResize = function () {

                if ($('.card-soup.responsive').is(':visible') === true && fakewaffle.currentPosition === 'tabs') {
                    fakewaffle.tabToPanel();
                    fakewaffle.currentPosition = 'panel';
                } else if ($('.card-soup.responsive').is(':visible') === false && fakewaffle.currentPosition === 'panel') {
                    fakewaffle.panelToTab();
                    fakewaffle.currentPosition = 'tabs';
                }

            };

            fakewaffle.tabToPanel = function () {

                var tabGroups = $('.nav-tabs.responsive');

                $.each(tabGroups, function (index, tabGroup) {

                    // Find the tab
                    var tabContents = $(tabGroup).next('.tab-content').find('.tab-pane');

                    $.each(tabContents, function (index, tabContent) {
                        // Find the id to move the element to
                        var destinationId = $(tabContent).attr('id').replace(/^/, '#collapse-');

                        // Convert tab to panel and move to destination
                        $(tabContent)
                            .removeClass('tab-pane')
                            .addClass('card-body fw-previous-tab-pane')
                            .appendTo($(destinationId));

                    });

                });

            };

            fakewaffle.panelToTab = function () {

                var panelGroups = $('.card-soup.responsive');

                $.each(panelGroups, function (index, panelGroup) {

                    var destinationId = $(panelGroup).attr('id').replace('collapse-', '#');
                    var destination = $(destinationId).next('.tab-content')[0];

                    // Find the panel contents
                    var panelContents = $(panelGroup).find('.card-body.fw-previous-tab-pane');

                    // Convert to tab and move to destination
                    panelContents
                        .removeClass('card-body fw-previous-tab-pane')
                        .addClass('tab-pane')
                        .appendTo($(destination));

                });

            };

            fakewaffle.bindTabToCollapse = function () {

                var tabs = $('.nav-tabs.responsive').find('li a');
                var collapse = $('.card-soup.responsive').find('.card-collapse');

                // Toggle the panels when the associated tab is toggled
                tabs.on('shown.bs.tab', function (e) {

                    if (fakewaffle.currentPosition === 'tabs') {
                        var $current = $(e.currentTarget.hash.replace(/#/, '#collapse-'));
                        $current.collapse('show');

                        if (e.relatedTarget) {
                            var $previous = $(e.relatedTarget.hash.replace(/#/, '#collapse-'));
                            $previous.collapse('hide');
                        }
                    }

                });

                // Toggle the tab when the associated panel is toggled
                collapse.on('shown.bs.collapse', function (e) {

                    if (fakewaffle.currentPosition === 'panel') {
                        // Activate current tabs
                        var current = $(e.target).context.id.replace(/collapse-/g, '#');
                        $('a[href="' + current + '"]').tab('show');

                        // Update the content with active
                        var panelGroup = $(e.currentTarget).closest('.card-soup.responsive');
                        $(panelGroup).find('.card-body').removeClass('active');
                        $(e.currentTarget).find('.card-body').addClass('active');
                    }

                });
            };

            $(window).resize(function () {
                fakewaffle.checkResize();
            });

            return fakewaffle;
        }(window.jQuery, fakewaffle || {}));

        fakewaffle.responsiveTabs();











        document.documentElement.setAttribute("lang", "en");
        document.documentElement.removeAttribute("class");

        axe.run(function (err, results) {
            console.log(results.violations);
        });

        // Get IE or Edge browser version
        var version = detectIE();

        if (version !== false) {
            alert('Please view in Chrome/Safari/Firefox');
        }
        /**
         * detect IE
         * returns version of IE or false, if browser is not Internet Explorer
         */
        function detectIE() {
            var ua = window.navigator.userAgent;

            var msie = ua.indexOf('MSIE ');
            if (msie > 0) {
                // IE 10 or older => return version number
                return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
            }

            var trident = ua.indexOf('Trident/');
            if (trident > 0) {
                // IE 11 => return version number
                var rv = ua.indexOf('rv:');
                return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
            }

            var edge = ua.indexOf('Edge/');
            if (edge > 0) {
                // Edge (IE 12+) => return version number
                return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
            }

            // other browser
            return false;
        }
    </script>
}